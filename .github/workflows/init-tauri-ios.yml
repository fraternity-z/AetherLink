name: Initialize Tauri iOS Project

on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘

jobs:
  init-ios:
    runs-on: macos-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm install

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: aarch64-apple-ios, x86_64-apple-ios

      - name: Install iOS targets
        run: |
          rustup target add aarch64-apple-ios
          rustup target add x86_64-apple-ios
          rustup target add aarch64-apple-ios-sim

      - name: Initialize Tauri iOS project
        run: npm run tauri ios init

      - name: Package iOS project files
        run: |
          cd src-tauri/gen
          tar -czf ios-project.tar.gz ios/
          mv ios-project.tar.gz ../../

      - name: Upload iOS project as artifact
        uses: actions/upload-artifact@v4
        with:
          name: tauri-ios-project
          path: ios-project.tar.gz
          retention-days: 7

      - name: Create summary
        run: |
          echo "## âœ… Tauri iOS é¡¹ç›®åˆå§‹åŒ–å®Œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¦ ä¸‹è½½æ­¥éª¤ï¼š" >> $GITHUB_STEP_SUMMARY
          echo "1. ç‚¹å‡»ä¸Šæ–¹çš„ Artifacts" >> $GITHUB_STEP_SUMMARY
          echo "2. ä¸‹è½½ \`tauri-ios-project\`" >> $GITHUB_STEP_SUMMARY
          echo "3. è§£åŽ‹åˆ°é¡¹ç›®æ ¹ç›®å½•" >> $GITHUB_STEP_SUMMARY
          echo "4. è¿è¡Œ: \`tar -xzf ios-project.tar.gz -C src-tauri/gen/\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“‚ ç”Ÿæˆçš„æ–‡ä»¶ï¼š" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          ls -la src-tauri/gen/ios/ || echo "iOS ç›®å½•æœªç”Ÿæˆ" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
